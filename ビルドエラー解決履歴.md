# Vercelãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼è§£æ±ºå±¥æ­´

## æ¦‚è¦
ç•™å­¦ã‚µãƒãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ–ãƒ©ãƒ³ãƒ‰LPã®Vercelãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ç™ºç”Ÿã—ã¦ã„ã‚‹`Permission denied`ã‚¨ãƒ©ãƒ¼ã®è©³ç´°åˆ†æã¨è§£æ±ºç­–ã®å±¥æ­´ã€‚

## ç¾åœ¨ã®ã‚¨ãƒ©ãƒ¼çŠ¶æ³

### æœ€æ–°ã®ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ï¼ˆ2024å¹´12æœˆæ™‚ç‚¹ï¼‰
```
Running "vercel build"
Vercel CLI 44.3.0
Running "install" command: `npm install`...
npm warn deprecated rimraf@3.0.2: Rimraf versions prior to v4 are no longer supported
npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
added 31 packages, changed 2 packages, and audited 443 packages in 3s
66 packages are looking for funding
  run `npm fund` for details
6 vulnerabilities (2 moderate, 4 high)
To address all issues (including breaking changes), run:
  npm audit fix --force
Run `npm audit` for details.
> study-abroad-branding-lp@1.0.0 build
> echo 'ğŸ— prepare' && npm run build:prepare && echo 'ğŸ¨ css' && npm run build:css && echo 'ğŸ“¦ js' && npm run build:js && echo 'ğŸ“‚ assets' && npm run copy:assets
```

**å•é¡Œ**: ãƒ“ãƒ«ãƒ‰ãŒ`build:css`ã®æ®µéšã§åœæ­¢ã—ã¦ã„ã‚‹

## ã‚¨ãƒ©ãƒ¼ã®æ ¹æœ¬åŸå› åˆ†æ

### 1. æ¨©é™ã‚¨ãƒ©ãƒ¼ã®åŸå› 
- **npxã‚³ãƒãƒ³ãƒ‰ã®å•é¡Œ**: `npx sass`ãŒä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ãƒã‚¤ãƒŠãƒªã‚’å±•é–‹ã™ã‚‹éš›ã«å®Ÿè¡Œæ¨©é™ãŒä¸è¶³
- **Vercelç’°å¢ƒã®åˆ¶ç´„**: Linuxç’°å¢ƒã§ã®æ¨©é™ç®¡ç†ãŒå³æ ¼
- **Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å½±éŸ¿**: ç‰¹å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã®npxã®å‹•ä½œå·®ç•°

### 2. å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼ç®‡æ‰€
```bash
# å•é¡Œã®ã‚ã‚‹ã‚³ãƒãƒ³ãƒ‰
npx sass src/scss/main.scss dist/css/main.css --style=compressed

# ã‚¨ãƒ©ãƒ¼å†…å®¹
Permission denied: /tmp/xxxxx/sass
```

## ã“ã‚Œã¾ã§è©¦è¡Œã—ãŸä¿®æ­£ç­–

### 1. Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š
**è©¦è¡Œæ—¥**: 2024å¹´12æœˆ
**ä¿®æ­£å†…å®¹**: `package.json`ã«Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
```json
{
  "engines": {
    "node": ">=18.0.0"
  }
}
```
**çµæœ**: åŠ¹æœãªã—

### 2. ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¿®æ­£
**è©¦è¡Œæ—¥**: 2024å¹´12æœˆ
**ä¿®æ­£å†…å®¹**: `package.json`ã®ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ®µéšçš„ã«å®Ÿè¡Œ
```json
{
  "scripts": {
    "build": "echo 'ğŸ— prepare' && npm run build:prepare && echo 'ğŸ¨ css' && npm run build:css && echo 'ğŸ“¦ js' && npm run build:js && echo 'ğŸ“‚ assets' && npm run copy:assets"
  }
}
```
**çµæœ**: ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ãŒåˆ¤æ˜

### 3. npx â†’ npm exec ã¸ã®å¤‰æ›´
**è©¦è¡Œæ—¥**: 2024å¹´12æœˆ
**ä¿®æ­£å†…å®¹**: `npx sass`ã‚’`npm exec sass`ã«å¤‰æ›´
```json
{
  "scripts": {
    "build:css": "npm exec sass src/scss/main.scss dist/css/main.css --style=compressed"
  }
}
```
**çµæœ**: æœ€æ–°ã®ä¿®æ­£ã€åŠ¹æœã‚’ç¢ºèªä¸­

### 4. ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
**è©¦è¡Œæ—¥**: 2024å¹´12æœˆ
**ä¿®æ­£å†…å®¹**: `copy-assets.js`ã®ä½œæˆ
```javascript
const fs = require('fs-extra');
const path = require('path');

async function copyAssets() {
  try {
    console.log('ğŸ“‚ ã‚¢ã‚»ãƒƒãƒˆã‚³ãƒ”ãƒ¼é–‹å§‹...');
    await fs.copy('src/images', 'dist/images');
    console.log('âœ… ã‚¢ã‚»ãƒƒãƒˆã‚³ãƒ”ãƒ¼å®Œäº†');
  } catch (error) {
    console.error('âŒ ã‚¢ã‚»ãƒƒãƒˆã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
    process.exit(1);
  }
}

copyAssets();
```
**çµæœ**: ã‚¢ã‚»ãƒƒãƒˆã‚³ãƒ”ãƒ¼ã¯æ­£å¸¸å‹•ä½œ

## ç¾åœ¨ã®package.jsonè¨­å®š

```json
{
  "name": "study-abroad-branding-lp",
  "version": "1.0.0",
  "engines": {
    "node": ">=18.0.0"
  },
  "scripts": {
    "dev": "live-server --port=3000 --open=/",
    "build": "echo 'ğŸ— prepare' && npm run build:prepare && echo 'ğŸ¨ css' && npm run build:css && echo 'ğŸ“¦ js' && npm run build:js && echo 'ğŸ“‚ assets' && npm run copy:assets",
    "build:prepare": "rimraf dist && mkdir -p dist/css dist/js dist/images",
    "build:css": "npm exec sass src/scss/main.scss dist/css/main.css --style=compressed",
    "build:js": "esbuild src/js/main.js --bundle --minify --outfile=dist/js/main.js",
    "copy:assets": "node copy-assets.js"
  },
  "devDependencies": {
    "esbuild": "^0.19.0",
    "live-server": "^1.2.2",
    "rimraf": "^5.0.0",
    "sass": "^1.69.0",
    "fs-extra": "^11.1.0"
  }
}
```

## è¿½åŠ ã§è©¦è¡Œã™ã¹ãè§£æ±ºç­–

### 1. ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹å¼
```json
{
  "scripts": {
    "build:css": "sass src/scss/main.scss dist/css/main.css --style=compressed"
  }
}
```

### 2. ãƒ‘ã‚¹æŒ‡å®šæ–¹å¼
```json
{
  "scripts": {
    "build:css": "./node_modules/.bin/sass src/scss/main.scss dist/css/main.css --style=compressed"
  }
}
```

### 3. ç’°å¢ƒå¤‰æ•°è¨­å®š
```json
{
  "scripts": {
    "build:css": "NODE_OPTIONS=--max_old_space_size=4096 npm exec sass src/scss/main.scss dist/css/main.css --style=compressed"
  }
}
```

### 4. ä»£æ›¿ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«
- **PostCSS**: Sassã®ä»£æ›¿ã¨ã—ã¦ä½¿ç”¨
- **Webpack**: ã‚ˆã‚ŠåŒ…æ‹¬çš„ãªãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«
- **Vite**: ãƒ¢ãƒ€ãƒ³ãªãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«

## æ¨å¥¨è§£æ±ºç­–

### æœ€å„ªå…ˆ: npm execæ–¹å¼ã®ç¢ºèª
ç¾åœ¨é©ç”¨æ¸ˆã¿ã®`npm exec sass`æ–¹å¼ãŒåŠ¹æœçš„ã§ã‚ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã€‚

### æ¬¡å–„ç­–: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install -g sass
```

### æœ€çµ‚æ‰‹æ®µ: ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«å¤‰æ›´
Viteã‚„Webpackã¸ã®ç§»è¡Œã‚’æ¤œè¨ã€‚

## ä»Šå¾Œã®å¯¾å¿œæ–¹é‡

1. **å³åº§ã®å¯¾å¿œ**: ç¾åœ¨ã®`npm exec`ä¿®æ­£ã®åŠ¹æœç¢ºèª
2. **æ®µéšçš„æ”¹å–„**: ä¸Šè¨˜ã®è¿½åŠ è§£æ±ºç­–ã‚’é †æ¬¡è©¦è¡Œ
3. **æ ¹æœ¬çš„è§£æ±º**: å¿…è¦ã«å¿œã˜ã¦ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã®è¦‹ç›´ã—

## å‚è€ƒæƒ…å ±

- **Vercelç’°å¢ƒ**: Linux (Ubuntu 20.04)
- **Node.js**: 18.xç³»
- **npm**: 9.xç³»
- **ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç®‡æ‰€**: `build:css`ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚

## devDependenciesãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œãªã„å ´åˆã®æ ¹æœ¬è§£æ±ºç­–ï¼ˆ2024å¹´12æœˆè¿½è¨˜ï¼‰

### èƒŒæ™¯
Vercelã®Productionãƒ“ãƒ«ãƒ‰ã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`devDependencies`ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€`sass`ã‚„`postcss`ãªã©ã‚’`devDependencies`ã«å…¥ã‚Œã¦ã„ã‚‹ã¨ã€æœ¬ç•ªãƒ“ãƒ«ãƒ‰æ™‚ã«`.bin/sass`ãŒã‚¹ã‚¿ãƒ–åŒ–ã¾ãŸã¯æ¨©é™ä¸è¶³ã¨ãªã‚Šã€`Permission denied (exit 126)`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

### ğŸš€ ä»Šã™ãã§ãã‚‹æ ¹æœ¬è§£æ±ºç­–

#### A. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’`dependencies`ã«ç§»ã™
1. `package.json`ã®`devDependencies`ã‹ã‚‰`sass`ã€`postcss`ã€`autoprefixer`ã‚’ã‚«ãƒƒãƒˆ
2. `dependencies`ã«ãƒšãƒ¼ã‚¹ãƒˆ
3. ãƒ­ãƒ¼ã‚«ãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ
   ```sh
   rm -rf node_modules package-lock.json && npm install
   ```
4. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
   ```sh
   git add package.json package-lock.json
   git commit -m "fix: move build deps to dependencies for Vercel"
   git push
   ```

â†’ ã“ã‚Œã§Vercelã¯æœ¬ç•ªç”¨ã®`dependencies`ã‚’å¿…ãšã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€`.bin/sass`ã«å®Ÿè¡Œæ¨©é™ãŒä»˜ãã€Permission deniedãŒè§£æ¶ˆã—ã¾ã™ã€‚

#### B. Vercelã«â€œdevDependenciesã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«â€ã•ã›ã‚‹
1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«`.npmrc`ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã‚’è¨˜è¼‰
   ```ini
   production=false
   ```
2. ã‚‚ã—ãã¯Vercelã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç’°å¢ƒå¤‰æ•°`NPM_CONFIG_PRODUCTION=false`ã‚’è¿½åŠ 

â†’ ã©ã¡ã‚‰ã‚‚`devDependencies`ã‚’å«ã‚ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã›ã‚‹æ–¹æ³•ã§ã™ã€‚

#### âœ… ã©ã¡ã‚‰ã‹1ã¤ã ã‘ã§OK
Aã¯ä¾å­˜ãŒâ€œæœ¬ç•ªç”¨â€ã«ç¢ºå®Ÿã«ãªã‚Šã€æœ€ã‚‚æ‰‹å …ã„ã§ã™ã€‚Bã¯â€œdevDependenciesã‚’ä¸¸ã”ã¨ä½¿ã„ãŸã„â€å ´åˆã«ã€‚

---

### ã¾ã¨ã‚
- Vercelã®Linuxç’°å¢ƒã§`npx`çµŒç”±ã®CLIå®Ÿè¡Œæ™‚ã«æ¨©é™ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã‚ã‚‹
- `dependencies`ã¸ã®ç§»å‹•ã€ã¾ãŸã¯`.npmrc`/ç’°å¢ƒå¤‰æ•°ã§ã®devDependenciesã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒæ ¹æœ¬è§£æ±ºç­–
- ã™ã¹ã¦ã®ä¿®æ­£ãƒ»çµŒç·¯ãƒ»æ¨å¥¨æ‰‹é †ã¯æœ¬ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜éŒ²

**æœ€çŸ­ã§ãƒ“ãƒ«ãƒ‰ã‚’é€šã™ã«ã¯Aæ¡ˆï¼ˆdependenciesç§»å‹•ï¼‰ãŒæ¨å¥¨**

---

**ä½œæˆæ—¥**: 2024å¹´12æœˆ
**ä½œæˆè€…**: AI Assistant
**å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: ç•™å­¦ã‚µãƒãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒ‰LP 